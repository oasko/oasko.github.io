
通过不同的实践练习探索防火墙、IDS、漏洞扫描程序和 SIEM 等基本的防御性安全解决方案

# SIEM 简介

什么是SIEM

SIEM代表**安全信息和事件管理系统**（Security Information and Event Management system）。它是一种从网络上的各种端点/网络设备收集数据、将它们存储在一个集中位置并对其进行关联的工具。这个房间将介绍理解SIEM及其工作原理所需的基本概念。

## task2
通过 SIEM 实现网络可视性

我们知道，每个网络组件可以有一个或多个日志源生成不同的日志。例如，可以设置Sysmon和 Windows 事件日志，以便更好地查看 Windows Endpoint。我们可以将网络日志源分为两个逻辑部分：

**1）以主机为中心的日志源**（host-centric）

这些是捕获主机内发生的或与主机相关的事件的日志源。一些生成以主机为中心的日志的日志源是 Windows 事件日志、Sysmon、Osquery 等。以主机为中心的日志的一些示例如下：

- 用户访问文件
- 尝试进行身份验证的用户。
- 流程执行活动
- 添加/编辑/删除注册表项或值的过程。
- Powershell执行

**2）以网络为中心的日志源**（network-centric）

当主机之间相互通信或访问互联网以访问网站时，会生成与网络相关的日志。一些基于网络的协议包括SSH、VPN、HTTP /s 、FTP等。此类事件的示例包括：

- SSH连接
- 通过FTP访问的文件
- 网络流量
- 用户通过VPN访问公司资源。
- 网络文件共享活动

SIEM 提供的一些主要功能包括：

- 实时日志采集
- 异常活动警报  
    
- 24/7 监控和可视性
- 通过早期检测防范最新威胁
- 数据洞察和可视化
- 调查过去事件的能力。
## task3
### 日志位置

Windows日志在event viewer中

llinux日志常见位置：
- /var/log/httpd  ：包含HTTP请求/响应和错误日志。
- /var/log/cron    ：与 cron 作业相关的事件存储在此位置。
- /var/log/auth.log 和 /var/log/secure  ：存储身份验证相关的日志。 
- /var/log/kern  ：此文件存储内核相关事件。

在Linux中，写入所有apache相关日志的常见位置是 /var/log/ apache 或 /var/log/httpd。

### 日志采集

所有这些日志都提供了丰富的信息，有助于识别安全问题。每个SIEM解决方案都有自己的日志提取方式。下面解释了这些SIEM解决方案使用的一些常见方法：  

1) 代理/转发器( Agent / Forwarder)： 这些SIEM解决方案提供了一个轻量级工具，称为代理（Splunk的转发器），安装在端点中。它配置为捕获所有重要日志并将其发送到SIEM服务器。  

2) Syslog：  Syslog 是一种广泛使用的协议，用于从各种系统（如 Web 服务器、数据库等）收集数据，并将实时数据发送到集中目的地。

3) 手动上传( Manual Upload)： 一些SIEM解决方案，如Splunk、ELK等，允许用户提取离线数据进行快速分析。一旦数据被提取，它就会被规范化并可供分析。

4) 端口转发(Port-Forwarding)： SIEM解决方案还可以配置为监听某个端口，然后端点将数据转发到监听端口上的SIEM实例。

## task4
### ## SIEM功能

SIEM是安全运营中心 ( SOC ) 生态系统的一个主要组成部分，SIEM首先收集日志，然后检查是否有任何事件/流与规则中设置的条件匹配或超过某个阈值

SIEM的一些常见功能包括：

- 来自不同日志源的事件之间的关联。
- 提供以主机为中心和以网络为中心的活动的可见性。
- 允许分析师调查最新的威胁并及时做出响应。
- 搜寻现有规则未检测到的威胁。

## task5

 ### 分析日志和警报

### 仪表板

仪表板是任何SIEM中最重要的组件。SIEM在标准化和提取数据后，会呈现这些数据以供分析。借助多个仪表板，这些分析的摘要以可操作的见解形式呈现。每个SIEM解决方案都带有一些默认仪表板，并提供自定义仪表板创建的选项。仪表板中可以找到的一些信息包括：

- 警报要点
- 系统通知
- 健康警报
- 失败登录尝试列表
- 事件采集数量
- 触发规则
- 访问次数最多的域名
### 警报调查

在监控SIEM时，分析师大部分时间都花在仪表板上，因为它以非常概括的方式显示有关网络的各种关键详细信息。触发警报后，将检查与警报相关的事件/流，并检查规则以查看满足哪些条件。根据调查，分析师确定它是真阳性还是假阳性。分析后执行的一些操作包括：

- 警报是误报。可能需要调整规则以避免再次发生类似的误报。  
- 
- 警报为真阳性。进行进一步调查。  
- 联系资产所有者询问有关活动的信息。
- 确认存在可疑活动。隔离受感染的主机。
- 封锁可疑IP。

# 防火墙基础知识

了解防火墙并使用 Windows 和 Linux 内置防火墙

我们需要为我们的数字设备配备一个安全卫士，来检查进出设备的数据。这个安全卫士就是我们所说的**防火墙**

完成房间后，您将有基本的了解：

- 防火墙的类型
- 防火墙规则及其组件
- 动手操作 Windows 内置防火墙 
- 动手操作Linux内置防火墙
## task2
防火墙类型
### 无状态防火墙

这种类型的防火墙在 OSI 模型的第 3 层和第 4 层上运行，其工作原理仅是根据预定规则过滤数据，而不注意先前连接的状态。这意味着它会将每个数据包与规则进行匹配，而不管该数据包是否属于合法连接。

### 状态防火墙

与无状态防火墙不同，这种类型的防火墙不仅会根据预定规则过滤数据包，还会跟踪以前的连接并将其存储在状态表中。这​​通过根据数据包的连接历史记录检查数据包，增加了另一层安全性。

### 代理 防火墙

代理防火墙或应用程序级网关充当专用网络和互联网之间的中介，并在 OSI 模型的第 7 层上运行。它们还会检查所有数据包的内容。网络中用户发出的请求在经过检查后由此代理转发，并使用其自己的 IP 地址进行屏蔽，从而为内部 IP 地址提供匿名性。内容过滤策略可应用于这些防火墙，以根据其内容允许/拒绝传入和传出流量。

### 下一代防火墙 (NGFW)

这是最先进的防火墙类型，运行在 OSI 模型的第 3 层到第 7 层，提供深度数据包检查和其他功能，可增强传入和传出网络流量的安全性。它具有入侵防御系统，可实时阻止恶意活动。它通过分析攻击模式并在攻击进入网络之前立即阻止攻击来提供启发式分析。NGFW 具有 SSL/TLS 解密功能，可在解密数据包后对其进行检查，并将数据与威胁情报源关联起来，以做出有效的决策。

|防火墙|特征|
|---|---|
|无状态防火墙|- 基本过滤  <br>- 不追踪以前的连接  <br>- 适用于高速网络|
|状态防火墙|- 根据模式识别流量  <br>- 可应用复杂规则  <br>- 监控网络连接|
|代理防火墙|- 还检查数据包内的数据  <br>- 提供内容过滤选项  <br>- 提供应用程序控制  <br>- 解密并检查 SSL/TLS 数据包|
|下一代防火墙|- 提供高级威胁防护  <br>- 配备入侵防御系统  <br>- 根据启发式分析识别异常  <br>- 解密并检查 SSL/TLS 数据包|
## task3
防火墙规则的基本组成部分如下所述：

- **源地址：发起流量的机器的 IP 地址。
- **目标地址：接收数据的机器的IP地址。
- **端口：流量的端口号。
- **协议：通信过程中使用的协议。
- **行动：** 这定义了在识别任何此类特定性质的流量时将采取的行动。
- 方向：此字段定义规则对传入或传出流量的适用性。

## task5
Netfilter 是Linux 操作系统内部的框架，具有核心防火墙功能，包括数据包过滤、NAT 和连接跟踪。此框架是Linux中用于控制网络流量的各种防火墙实用程序 的基础。下面列出了一些使用此框架的常见防火墙实用程序：

- **iptables：这是许多**Linux发行版中使用最广泛的实用程序。它使用 Netfilter 框架，该框架提供各种功能来控制网络流量。
- **nftables：它是“iptables”实用程序的后继者，具有增强的数据包过滤和 NAT 功能。它也基于 Netfilter 框架。
- **firewalld：此实用程序也在 Netfilter 框架上运行，并具有预定义的规则集。它的工作方式与其他实用程序不同，并带有不同的预建网络区域配置。

### ufw
ufw（Uncomplicated Firewall），顾名思义，它通过为您提供更简单的界面，消除了在“iptables”（或其后继者）中以复杂语法制定规则的复杂性

查看状态
```
sudo ufw status
```

启动
```
sudo ufw enable
```

 ufw 发布规则来拒绝从您的机器传出的所有流量
```
ufw default deny outgoing
```

# # IDS 基础知识

了解 IDS 的基础知识以及使用 Snort 的经验。

## 学习目标

- IDS的类型及其检测能力
- Snort IDS的工作原理
- Snort IDS中的默认规则和自定义规则
- 在 Snort IDS中制定自定义规则

## task2
### 部署模式

IDS可以按照以下方式部署：

- **主机入侵检测系统 ( HIDS )**：基于主机的IDS解决方案单独安装在主机上，仅负责检测与特定主机相关的潜在安全威胁。它们提供主机活动的详细可见性。然而，主机入侵检测系统在大型网络中管理起来可能具有挑战性，因为它们占用大量资源，并且需要在每个主机上进行管理。
    
- **网络入侵检测系统 ( NIDS )**：基于网络的IDS解决方案对于检测整个网络内的潜在恶意活动至关重要，无论特定主机是什么。它们监控所有相关主机的网络流量以检测可疑活动。它提供了整个网络内所有检测的集中视图。

### 检测模式

- **基于签名的IDS**：每天都会发生许多攻击。每种攻击都有其独特的模式，称为签名。这些签名由IDS保存在其数据库中，以便如果将来发生相同的攻击，它会通过其签名检测到并报告给安全管理员以采取行动。IDS 的签名数据库越强大，它检测已知威胁的效率就越高。但是，基于签名的IDS无法检测零日攻击。零日攻击没有先前的签名（模式），也不会保存在IDS数据库中。因此，基于签名的IDS只能检测以前发生的攻击，其签名（模式）保存在数据库中。在接下来的任务中，我们将探索一个名为 Snort 的基于签名的IDS。
    
- **基于异常的IDS**：这种类型的IDS首先学习网络或系统的正常行为（基线），如果有任何偏离正常行为的行为，则执行检测。基于异常的IDS还可以检测零日攻击，因为它们不依赖可用的签名进行检测，而是通过将当前状态与正常行为（基线）进行比较来检测网络或系统内部的异常。但是，这种类型的IDS可能会产生大量误报（将良性活动标记为恶意），因为大多数合法程序的性质与恶意程序相符。基于异常的IDS会将它们标记为恶意，并认为任何行为异常的行为都是恶意的。我们还可以通过微调基于异常的IDS （手动定义IDS中的正常行为）来减少其产生的误报。
    
- **混合IDS**：混合IDS结合了基于签名的IDS和基于异常的IDS的检测方法，以充分利用每种方法的优势。一些已知威胁可能已经在IDS数据库中具有一些签名；在这种情况下，混合IDS将使用基于签名的IDS的检测技术。如果遇到新威胁，它可以利用基于异常的 IDS的检测方法。

## task3
Snort 是 1998 年开发的最广泛使用的开源IDS解决方案之一。

| 模式         | 描述                                                                                                                                                                       | 用例                                                                     |
| ---------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ---------------------------------------------------------------------- |
| 数据包嗅探器模式   | 此模式读取并显示网络数据包，但不对其进行任何分析。Snort 的数据包嗅探器模式与IDS功能没有直接关系，但它有助于网络监控和故障排除。在某些情况下，系统管理员可能需要读取流量而不执行任何检测来诊断特定问题。在这种情况下，他们可以利用 Snort 的数据包嗅探器模式。此模式允许您在控制台上显示网络流量，甚至将其输出到文件中。      | 网络团队观察到一些网络性能问题。为了诊断问题，他们需要详细了解网络流量。为此，他们可以利用 Snort 的数据包嗅探器模式。         |
| 数据包记录模式    | Snort 实时检测网络流量，并将检测结果以警报形式显示在控制台上，以便安全管理员采取行动。但是，在某些情况下，需要记录网络流量以供日后分析。Snort 的数据包记录模式允许您将网络流量记录为PCAP（标准数据包捕获格式）文件。这包括所有网络流量及其检测结果。取证调查人员可以使用这些 Snort 日志文件对以前的攻击进行根本原因分析。 | 安全团队需要对网络攻击进行取证调查。他们需要流量日志来执行根本原因分析。通过 Snort 的数据包记录模式记录的网络流量可以为他们提供帮助。 |
| 网络入侵检测系统模式 | Snort 的NIDS模式是主要模式，它实时监控网络流量并应用其规则文件来识别与存储为签名的已知攻击模式的任何匹配。如果匹配，它会生成警报。此模式提供IDS 解决方案的主要功能。                                                                                | 安全团队必须主动监控其网络或系统以检测潜在威胁。他们可以利用 Snort 的NIDS 模式来实现这一点。                   |

本规则涉及组件的详细信息如下：

- **操作**：指定规则触发时要采取的操作。在本例中，我们设置了当流量与此规则匹配时“发出警报”的操作。
    
- **协议**：这指的是与此规则匹配的协议。在本例中，我们使用 ping 主机时使用的协议“ICMP”。
    
- **源 IP**：这决定了流量的来源 IP。由于我们想要检测来自任何源 IP 的流量，因此我们将其设置为“任意”。
    
- **源端口**：这决定了流量来自哪个端口。由于我们想检测来自任何源端口的流量，因此我们将其设置为“任意”。
    
- **目标 IP**：这指定匹配流量到达的目标 IP；它会生成警报。在本例中，我们使用了“$HOME_NET”。这是一个变量，我们在 Snort 的配置文件中将其值定义为整个网络的范围。
    
- **目标端口**：指定流量将到达的端口。由于我们想检测来自任何端口的流量，因此我们将其设置为“任意”。
    
- **规则元数据**：每个规则都有一些元数据。这些元数据在规则末尾的括号中定义。以下是其组成部分：
    
	- **消息 (msg)**：这描述了主题规则触发时要显示的消息。该消息应表明检测到的活动类型。在本例中，我们使用了“检测到 Ping”。
	    
	- **签名 ID (sid)**：每条规则都有一个唯一的标识符，用于将其与其他规则区分开来。此标识符称为签名 ID (sid)。在本例中，我们将 sid 设置为“10001”。
	    
	- **规则修订 (rev)**：设置规则的修订号。每次修改规则时，其修订号都会增加。这有助于跟踪任何规则的更改。

# # 漏洞扫描程序概述

了解漏洞扫描程序及其在实际场景中的工作原理。
## task2
### 经过身份验证的扫描与未经身份验证的扫描
| 已验证扫描                               | 未经身份验证的扫描                   |
| ----------------------------------- | --------------------------- |
| 必须向漏洞扫描程序提供目标主机的凭证。                 | 漏洞扫描程序不需要主机的凭据；它只需要 IP 地址。  |
| 识别可被访问主机的攻击者利用的漏洞。                  | 识别无法访问目标主机的外部攻击者可以利用的漏洞。    |
| 通过扫描目标系统的配置和已安装的应用程序，它可以更深入地了解目标系统。 | 它所需的资源较少，并且设置起来很简单。         |
| 例如，通过向漏洞扫描程序提供其凭据来扫描内部数据库。          | 例如，扫描面向公众的网站以查找任何用户可以利用的漏洞。 |
### 内部扫描与外部扫描
| 内部扫描               | 外部扫描                 |
| ------------------ | -------------------- |
| 从网络内部进行。           | 从网络外部进行。             |
| 它主要关注网络内部可以利用的漏洞。  | 它主要关注那些可以从网络外部利用的漏洞。 |
| 识别攻击者进入网络后可能暴露的漏洞。 | 识别网络外部向攻击者暴露的漏洞。     |
## task3
漏洞扫描工具

nessus

qualys

nexpose

openvas

## task4
### 漏洞漏洞

CVE代表常见漏洞和暴露。将CVE视为您每个查询和投诉的唯一编号。如果任何问题有任何更新，您可以使用唯一的 CVE编号轻松跟进。从帮助台示例场景中可以看出，此CVE编号是分配给漏洞的唯一编号。它由MITRE公司 开发。每当在任何软件应用程序中发现新漏洞时，都会为其分配一个唯一的CVE编号作为参考，并在CVE数据库中在线发布。此出版物旨在让人们意识到这些漏洞，以便他们可以采取保护措施来修复它们。您可以在CVE数据库中找到任何以前发现的漏洞的详细信息。下图是分配给漏洞的CVE编号示例：

- **CVE前缀：**每个CVE编号开头都有前缀“ CVE ”。
- **年份：每个**CVE编号的第二部分包含发现它的年份（例如，2024 年）。
- **任意数字：**CVE编号的最后一部分包含四个或更多任意数字（例如 9374）


